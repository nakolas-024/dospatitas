---
// src/pages/catalogo/ninos.astro (CORREGIDO)
import Layout from '../../layouts/Layout.astro';
import ProductCard from '../../components/ProductCard.astro';
import ProductFullCard from '../../components/ProductFullCard.astro'; // <-- AÑADIDO: Importar el modal
import { supabase } from '../../lib/supabaseClient';

// Cargar productos específicos para "Niños"
let products = [];
let fetchError = null;

try {
  // Asegúrate de que 'Niños' coincida exactamente con tu DB
  const { data, error } = await supabase
    .from('products')
    .select('id, name, category, image_url_ref, image_url_full') // Seleccionar columnas necesarias
    .eq('category', 'Niños')
    .order('created_at', { ascending: false });

  if (error) throw error;
  products = data || [];
  console.log(`✅ Productos 'Niños' cargados: ${products.length}`);
} catch (err) {
  console.error("❌ Error al cargar productos 'Niños':", err);
  fetchError = err;
}

// Categorías para la navegación
const allCategories = [
  { name: 'Niños', href: '/catalogo/ninos', id: 'Niños' },
  { name: 'Niñas', href: '/catalogo/ninas', id: 'Niñas' },
  { name: 'Mascotas', href: '/catalogo/veterinarios', id: 'Mascotas' },
];
const currentCategory = 'Niños'; // Marcar 'Niños' como activa
---

<Layout title="Catálogo - Carnets de Control Sano para Niños">
  <main class="catalog-page">
    <div class="container">
      <div class="catalog-header">
        <h1>Carnets de Control Sano para Niños</h1>
        <p class="subtitle">Un recuerdo único y personalizado para seguir cada etapa de su crecimiento.</p>
      </div>

      {/* Navegación de Categorías */}
      <nav class="category-nav">
        <ul>
          {allCategories.map(cat => (
            <li>
              <a href={cat.href} class:list={{ active: cat.id === currentCategory }}>
                {cat.name}
              </a>
            </li>
          ))}
        </ul>
      </nav>

      {/* Listado de productos */}
      {fetchError ? (
        <p class="error">
          <strong>Error al cargar productos:</strong> {fetchError.message || 'Error desconocido.'}
          <br /><small>(Ver consola del servidor y RLS en Supabase)</small>
        </p>
      ) : (
        <div class="product-grid">
          {products.length > 0 ? (
            products.map(product => (
              <> {/* Agrupar tarjeta y modal */}
                <ProductCard product={product} />
                <ProductFullCard product={product} /> {/* <-- AÑADIDO: Renderizar el modal */}
              </>
            ))
          ) : (
            <p class="no-products-message">
              Aún no hemos agregado productos en esta categoría. ¡Vuelve pronto!
            </p>
          )}
        </div>
      )}
    </div>
  </main>
</Layout>

{/* NO hay script aquí */}

<style>
/* Estilos adaptados para la página de Niños */
.catalog-page { padding: 4rem 0; background-color: #f0f8ff; } /* Fondo azul claro */
.container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; }
.catalog-header { text-align: center; margin-bottom: 2.5rem; }
h1 { font-size: 2.2rem; color: #0056b3; } /* Título en azul oscuro */
.subtitle { color: #6c757d; margin-top: 0.5rem; }
.category-nav { display: flex; justify-content: center; margin-bottom: 3rem; }
.category-nav ul { display: flex; gap: 0.5rem; padding: 0; list-style: none; flex-wrap: wrap; justify-content: center; }
.category-nav a { padding: 0.6rem 1.4rem; border-radius: 50px; text-decoration: none; font-weight: 600; color: #444; border: 2px solid transparent; transition: all 0.25s ease; }
.category-nav a:hover { border-color: #add8e6; } /* Borde azul claro en hover */
.category-nav a.active { background: #007bff; color: white; border-color: #007bff; font-weight: 700; } /* Activo en azul */
.product-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; }
.no-products-message, .error { grid-column: 1 / -1; text-align: center; color: #777; font-size: 1.1rem; padding: 3rem 1rem; background: #fff; border: 1px dashed #ddd; border-radius: 12px; }
.error { color: red; background: #ffeaea; border-color: red; }
.error small { color: #555; display: block; margin-top: 0.5rem; }
</style>